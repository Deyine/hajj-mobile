<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebView File Upload Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            direction: rtl;
        }
        .test-box {
            border: 2px dashed #ccc;
            padding: 40px;
            text-align: center;
            border-radius: 8px;
            margin: 20px 0;
            cursor: pointer;
        }
        .test-box:hover {
            border-color: #4CAF50;
            background-color: #f0f0f0;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        img {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        .info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ WebView</h1>

    <div class="info">
        <strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ WebView
        <br><br>
        <strong>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©:</strong> Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø£Ø¯Ù†Ø§Ù‡. Ø¥Ø°Ø§ ÙØªØ­ Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ù…Ù„ÙØ§ØªØŒ ÙØ§Ù„ØªÙƒÙˆÙŠÙ† ØµØ­ÙŠØ­ âœ…
    </div>

    <div id="test-area">
        <input type="file" id="fileInput" accept="image/*">
        <label for="fileInput" class="test-box">
            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“¸</div>
            <div style="font-size: 18px; font-weight: bold;">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</div>
            <div style="font-size: 14px; color: #666; margin-top: 10px;">
                ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØªØ­ Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø£Ùˆ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            </div>
        </label>
    </div>

    <div id="result"></div>
    <div id="preview"></div>

    <button onclick="testProgrammatic()">Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø±Ù…Ø¬ÙŠ (Programmatic Click)</button>

    <div class="info" style="margin-top: 30px;">
        <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©:</h3>
        <div id="env-info"></div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const result = document.getElementById('result');
        const preview = document.getElementById('preview');
        const envInfo = document.getElementById('env-info');

        // Display environment info
        envInfo.innerHTML = `
            <strong>User Agent:</strong><br>
            <small>${navigator.userAgent}</small><br><br>
            <strong>Platform:</strong> ${navigator.platform}<br>
            <strong>URL:</strong> ${window.location.href}<br>
            <strong>Is WebView:</strong> ${isWebView() ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ (Ù…ØªØµÙØ­ Ø¹Ø§Ø¯ÙŠ)'}<br>
        `;

        function isWebView() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.includes('wv') || ua.includes('webview');
        }

        // Track if file input was clicked
        let clickAttempted = false;

        fileInput.addEventListener('click', () => {
            clickAttempted = true;
            console.log('âœ… File input clicked');
        });

        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];

            if (file) {
                result.innerHTML = `
                    <div class="result success">
                        <strong>âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</strong><br>
                        <br>
                        <strong>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${file.name}<br>
                        <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${file.type}<br>
                        <strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${(file.size / 1024).toFixed(2)} KB<br>
                        <br>
                        <em>Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙÙŠ WebView âœ…</em>
                    </div>
                `;

                // Show preview
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.innerHTML = `
                            <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©:</h3>
                            <img src="${e.target.result}" alt="Preview">
                        `;
                    };
                    reader.readAsDataURL(file);
                }

                console.log('âœ… File selected:', file);
            }
        });

        // Test if file dialog opens
        setTimeout(() => {
            if (!clickAttempted) {
                // User clicked but file input didn't receive click event
                const clickHandler = () => {
                    setTimeout(() => {
                        if (!fileInput.files.length) {
                            result.innerHTML = `
                                <div class="result warning">
                                    <strong>âš ï¸ ØªØ­Ø°ÙŠØ±</strong><br>
                                    <br>
                                    Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ·.<br>
                                    <br>
                                    <strong>Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</strong><br>
                                    1. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ù„ØºÙ‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø·Ø¨ÙŠØ¹ÙŠ)<br>
                                    2. Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù… ÙŠÙØªØ­ (Ù…Ø´ÙƒÙ„Ø© ÙÙŠ WebView)<br>
                                    <br>
                                    Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØªØ­ Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ØŒ Ø±Ø§Ø¬Ø¹:<br>
                                    <code>WEBVIEW_FILE_UPLOAD_CONFIGURATION.md</code>
                                </div>
                            `;
                        }
                    }, 500);
                };

                fileInput.addEventListener('click', clickHandler, { once: true });
            }
        }, 100);

        // Programmatic test
        function testProgrammatic() {
            console.log('ğŸ§ª Testing programmatic click...');
            const testInput = document.createElement('input');
            testInput.type = 'file';
            testInput.accept = 'image/*';

            testInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    result.innerHTML = `
                        <div class="result success">
                            âœ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ù†Ø¬Ø­! Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙØ¹Ù‘Ù„.
                        </div>
                    `;
                    console.log('âœ… Programmatic test successful');
                }
            });

            document.body.appendChild(testInput);
            testInput.click();

            setTimeout(() => {
                if (testInput.files.length === 0) {
                    result.innerHTML = `
                        <div class="result error">
                            <strong>âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ</strong><br>
                            <br>
                            Ù„Ù… ÙŠÙØªØ­ Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ.<br>
                            <br>
                            <strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> WebView Ù„Ù… ÙŠØªÙ… ØªÙƒÙˆÙŠÙ† <code>onShowFileChooser</code><br>
                            <br>
                            <strong>Ø§Ù„Ø­Ù„:</strong> Ø±Ø§Ø¬Ø¹ <code>WEBVIEW_FILE_UPLOAD_CONFIGURATION.md</code>
                        </div>
                    `;
                    console.error('âŒ Programmatic test failed');
                }
                document.body.removeChild(testInput);
            }, 1000);
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('ğŸ“± WebView File Upload Test Page Loaded');
            console.log('ğŸ” User Agent:', navigator.userAgent);
            console.log('ğŸŒ Platform:', navigator.platform);
            console.log('ğŸ“ URL:', window.location.href);

            if (!isWebView()) {
                result.innerHTML = `
                    <div class="result warning">
                        <strong>â„¹ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©</strong><br>
                        <br>
                        Ù„Ø§ ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù‡Ø°Ø§ WebView (Ù…ØªØµÙØ­ Ø¹Ø§Ø¯ÙŠ).<br>
                        Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©.<br>
                        <br>
                        Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙÙŠ WebView Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
                    </div>
                `;
            }
        });
    </script>
</body>
</html>

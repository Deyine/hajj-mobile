# Nginx configuration update for hajj-mobile frontend
# Add this to: /etc/nginx/sites-available/hajj-mobile.next-version.com

server {
        server_name hajj-mobile.next-version.com;

        root /var/www/hajj-mobile/dist;
        access_log /var/log/nginx/hajj-mobile-access.log combined;
        error_log /var/log/nginx/hajj-mobile-error.log warn;

        # IMPORTANT: Add this BEFORE the /api/ location block
        # This proxies /cb to the backend for OAuth callback handling
        location = /cb {
            proxy_pass https://hajj-api.next-version.com/cb;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Host $host;
            proxy_redirect off;

            # Preserve all query parameters
            proxy_pass_request_headers on;

            # Enable cookies
            proxy_cookie_path / /;
        }

        # Existing /api/ proxy
        location /api/ {
            proxy_pass https://hajj-api.next-version.com/api/;
            proxy_redirect default;
        }

        # Existing catch-all for frontend
        location / {
          index index.html index.htm;
          try_files $uri $uri/ /index.html;
        }

    # SSL configuration remains the same
}
